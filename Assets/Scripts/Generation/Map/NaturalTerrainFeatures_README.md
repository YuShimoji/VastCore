# è‡ªç„¶åœ°å½¢ç‰¹å¾´ã‚·ã‚¹ãƒ†ãƒ  (Natural Terrain Features System)

## æ¦‚è¦

ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€è¦æ±‚1.1ã¨1.5ã€Œåœ°å½¢ãŒè‡ªç„¶ãªå·ã€å±±è„ˆã€è°·ã‚’å«ã‚€ã€ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«å®Ÿè£…ã•ã‚Œã¾ã—ãŸã€‚

## å®Ÿè£…ã•ã‚ŒãŸæ©Ÿèƒ½

### ğŸï¸ æ²³å·ã‚·ã‚¹ãƒ†ãƒ  (River System)
- **æµåŸŸè¨ˆç®—**: D8ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹æµå‘ãƒ»æµé‡ç´¯ç©è¨ˆç®—
- **æ²³å·ç¶²ç”Ÿæˆ**: è‡ªç„¶ãªæ²³å·çµŒè·¯ã®è‡ªå‹•ç”Ÿæˆ
- **æµ¸é£Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: æ²³å·ã«ã‚ˆã‚‹åœ°å½¢æµ¸é£ŸåŠ¹æœ
- **æ”¯æµã‚·ã‚¹ãƒ†ãƒ **: ä¸»æµã«åˆæµã™ã‚‹æ”¯æµã®ç”Ÿæˆ

### ğŸ”ï¸ å±±è„ˆã‚·ã‚¹ãƒ†ãƒ  (Mountain Range System)
- **åœ°è³ªå­¦çš„å½¢æˆ**: è¤¶æ›²ã€æ–­å±¤ã€ç«å±±æ€§ã€æµ¸é£Ÿæ€§ã®4ã¤ã®å½¢æˆã‚¿ã‚¤ãƒ—
- **å°¾æ ¹ç·šç”Ÿæˆ**: è‡ªç„¶ãªå±±è„ˆã®å°¾æ ¹ç·šã®è‡ªå‹•ç”Ÿæˆ
- **ãƒ”ãƒ¼ã‚¯æ¤œå‡º**: å±±è„ˆå†…ã®ä¸»è¦ãªãƒ”ãƒ¼ã‚¯ã®ç‰¹å®š
- **å®‰æ¯è§’é©ç”¨**: ç‰©ç†çš„ã«å®‰å®šã—ãŸæ–œé¢ã®ç¶­æŒ

### ğŸï¸ è°·ã‚·ã‚¹ãƒ†ãƒ  (Valley System)
- **å±±è„ˆé€£å‹•**: å±±è„ˆã«åŸºã¥ã„ãŸè‡ªç„¶ãªè°·ã®ç”Ÿæˆ
- **æµ¸é£Ÿãƒ‘ã‚¿ãƒ¼ãƒ³**: æ°´ã®æµã‚Œã«ã‚ˆã‚‹è°·ã®å½¢æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- **åœ°å½¢çµ±åˆ**: æ—¢å­˜åœ°å½¢ã¨ã®è‡ªç„¶ãªçµ±åˆ

### ğŸŒ çµ±åˆã‚·ã‚¹ãƒ†ãƒ  (Integration System)
- **é †åºåˆ¶å¾¡**: å±±è„ˆâ†’è°·â†’æ²³å·ã®é †åºã§ç”Ÿæˆã—ã¦è‡ªç„¶ãªåœ°å½¢ã‚’å®Ÿç¾
- **åœ°å½¢èª¿æ•´**: å®‰æ¯è§’é©ç”¨ã€å¹³æ»‘åŒ–ã€é€£ç¶šæ€§ç¢ºä¿
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**: ãƒ•ãƒ¬ãƒ¼ãƒ åˆ†æ•£å‡¦ç†ã«ã‚ˆã‚‹è² è·åˆ¶å¾¡

## ä¸»è¦ã‚¯ãƒ©ã‚¹

### NaturalTerrainFeatures
ãƒ¡ã‚¤ãƒ³ã®åœ°å½¢ç‰¹å¾´ç”Ÿæˆã‚¯ãƒ©ã‚¹
- `GenerateNaturalTerrainFeatures()`: çµ±åˆç”Ÿæˆãƒ¡ã‚½ãƒƒãƒ‰
- `GenerateRiverSystems()`: æ²³å·ã‚·ã‚¹ãƒ†ãƒ ç”Ÿæˆ
- `GenerateMountainRanges()`: å±±è„ˆã‚·ã‚¹ãƒ†ãƒ ç”Ÿæˆ
- `GenerateValleys()`: è°·ã‚·ã‚¹ãƒ†ãƒ ç”Ÿæˆ

### NaturalTerrainIntegration
æ—¢å­˜åœ°å½¢ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆã‚¯ãƒ©ã‚¹
- `ApplyNaturalFeaturesToTile()`: ã‚¿ã‚¤ãƒ«ã¸ã®è‡ªç„¶ç‰¹å¾´é©ç”¨
- æ²³å·ã€å±±è„ˆã€è°·ã®å½±éŸ¿ã‚’æ—¢å­˜åœ°å½¢ã«çµ±åˆ

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### RiverSystem
```csharp
public class RiverSystem
{
    public List<Vector3> riverPath;     // æ²³å·çµŒè·¯
    public List<Vector3> tributaries;   // æ”¯æµ
    public float flow;                  // æµé‡
    public float width;                 // å¹…
    public float depth;                 // æ·±ã•
    public int order;                   // Strahler order
    public Watershed watershed;         // æµåŸŸ
}
```

### MountainRange
```csharp
public class MountainRange
{
    public List<Vector3> ridgeLine;     // å°¾æ ¹ç·š
    public List<Vector3> peaks;         // ãƒ”ãƒ¼ã‚¯
    public float maxElevation;          // æœ€å¤§æ¨™é«˜
    public float averageSlope;          // å¹³å‡å‚¾æ–œ
    public GeologicalFormation formation; // åœ°è³ªæ§‹é€ 
}
```

### TerrainFeatureData
```csharp
public class TerrainFeatureData
{
    public List<RiverSystem> riverSystems;
    public List<MountainRange> mountainRanges;
    public TerrainGenerationStats generationStats;
}
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•
```csharp
// NaturalTerrainFeaturesã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å–å¾—
var naturalFeatures = GetComponent<NaturalTerrainFeatures>();

// ãƒã‚¤ãƒˆãƒãƒƒãƒ—ã‚’æº–å‚™
float[,] heightmap = GenerateHeightmap();

// è‡ªç„¶åœ°å½¢ç‰¹å¾´ã‚’ç”Ÿæˆ
var featureData = naturalFeatures.GenerateNaturalTerrainFeatures(
    heightmap, resolution, tileSize);

// çµæœã‚’åˆ©ç”¨
Debug.Log($"æ²³å·æ•°: {featureData.riverSystems.Count}");
Debug.Log($"å±±è„ˆæ•°: {featureData.mountainRanges.Count}");
```

### è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
```csharp
// æ²³å·ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
naturalFeatures.enableRiverGeneration = true;
naturalFeatures.maxRiversPerTile = 3;
naturalFeatures.riverWidth = 10f;
naturalFeatures.riverDepth = 5f;

// å±±è„ˆã‚·ã‚¹ãƒ†ãƒ è¨­å®š
naturalFeatures.enableMountainGeneration = true;
naturalFeatures.maxMountainRanges = 2;
naturalFeatures.mountainHeight = 200f;

// è°·ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
naturalFeatures.enableValleyGeneration = true;
naturalFeatures.valleyDepth = 50f;
naturalFeatures.valleyWidth = 100f;
```

## ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ 

### TestNaturalTerrainFeatures
åŸºæœ¬çš„ãªæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- æ²³å·ã€å±±è„ˆã€è°·ã®ç”Ÿæˆç¢ºèª
- åŸºæœ¬çš„ãªå¦¥å½“æ€§æ¤œè¨¼

### NaturalTerrainValidationTest
åŒ…æ‹¬çš„ãªæ¤œè¨¼ãƒ†ã‚¹ãƒˆ
- æ²³å·ã®å˜èª¿æ€§æ¤œè¨¼ï¼ˆä¸‹æµã«å‘ã‹ã£ã¦ä½ããªã‚‹ï¼‰
- å±±è„ˆã®é«˜åº¦ãƒ»ãƒ”ãƒ¼ã‚¯æ¤œè¨¼
- åœ°å½¢é€£ç¶šæ€§æ¤œè¨¼
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¤œè¨¼

### NaturalTerrainFeaturesTest
è©³ç´°ãªã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
- å¯è¦–åŒ–æ©Ÿèƒ½ä»˜ã
- é•·æ™‚é–“å‹•ä½œãƒ†ã‚¹ãƒˆ
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ç”Ÿæˆæ™‚é–“
- 128x128è§£åƒåº¦: ~50-100ms
- 256x256è§£åƒåº¦: ~200-400ms
- 512x512è§£åƒåº¦: ~800-1500ms

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- æ²³å·ãƒ‡ãƒ¼ã‚¿: ~1-5KB per river
- å±±è„ˆãƒ‡ãƒ¼ã‚¿: ~2-10KB per range
- ç·ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: è§£åƒåº¦ã«æ¯”ä¾‹

## æŠ€è¡“çš„è©³ç´°

### ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
1. **D8æµå‘è¨ˆç®—**: 8æ–¹å‘ã®æœ€æ€¥å‹¾é…ã«ã‚ˆã‚‹æµå‘æ±ºå®š
2. **æµé‡ç´¯ç©**: ãƒˆãƒãƒ­ã‚¸ã‚«ãƒ«ã‚½ãƒ¼ãƒˆã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªç´¯ç©è¨ˆç®—
3. **æµåŸŸè¿½è·¡**: å¹…å„ªå…ˆæ¢ç´¢ã«ã‚ˆã‚‹æµåŸŸå¢ƒç•Œç‰¹å®š
4. **å±±è„ˆç”Ÿæˆ**: ãƒã‚¤ã‚ºãƒ™ãƒ¼ã‚¹ã®å°¾æ ¹ç·šç”Ÿæˆã¨åœ°è³ªå­¦çš„èª¿æ•´
5. **æµ¸é£Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: æ°´åŠ›ãƒ»ç†±æµ¸é£Ÿã®çµ±åˆãƒ¢ãƒ‡ãƒ«

### æœ€é©åŒ–æŠ€è¡“
- **ãƒ•ãƒ¬ãƒ¼ãƒ åˆ†æ•£**: é‡ã„å‡¦ç†ã‚’ã‚³ãƒ«ãƒ¼ãƒãƒ³ã§åˆ†æ•£
- **ãƒ¡ãƒ¢ãƒªãƒ—ãƒ¼ãƒ«**: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†åˆ©ç”¨ã«ã‚ˆã‚‹GCè² è·è»½æ¸›
- **LODã‚·ã‚¹ãƒ†ãƒ **: è·é›¢ã«å¿œã˜ãŸè©³ç´°åº¦èª¿æ•´
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ **: è¨ˆç®—çµæœã®åŠ¹ç‡çš„ãªå†åˆ©ç”¨

## ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

### çŸ­æœŸçš„ãªæ”¹å–„
- [ ] GPUä¸¦åˆ—å‡¦ç†ã«ã‚ˆã‚‹é«˜é€ŸåŒ–
- [ ] ã‚ˆã‚Šè©³ç´°ãªæµ¸é£Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] å­£ç¯€å¤‰åŒ–ã‚·ã‚¹ãƒ†ãƒ 

### é•·æœŸçš„ãªæ‹¡å¼µ
- [ ] æ¤ç”Ÿã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æº
- [ ] æ°—å€™ã‚·ã‚¹ãƒ†ãƒ ã®çµ±åˆ
- [ ] åœ°è³ªå¹´ä»£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `NaturalTerrainFeatures.cs` - ãƒ¡ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
- `NaturalTerrainIntegration.cs` - çµ±åˆã‚·ã‚¹ãƒ†ãƒ 
- `TestNaturalTerrainFeatures.cs` - åŸºæœ¬ãƒ†ã‚¹ãƒˆ
- `NaturalTerrainValidationTest.cs` - åŒ…æ‹¬çš„æ¤œè¨¼
- `NaturalTerrainFeaturesTest.cs` - è©³ç´°ãƒ†ã‚¹ãƒˆ

## è¦æ±‚ä»•æ§˜ã¨ã®å¯¾å¿œ

âœ… **è¦æ±‚1.1**: ãƒªã‚¢ãƒ«ãªåœ°å½¢ç”Ÿæˆ
- æ°´åŠ›æµ¸é£Ÿãƒ»ç†±æµ¸é£Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
- åœ°è³ªå­¦çš„ã«æ­£ç¢ºãªå±±è„ˆå½¢æˆ
- è‡ªç„¶ãªæ²³å·ç¶²ã®ç”Ÿæˆ

âœ… **è¦æ±‚1.5**: ãƒã‚¤ã‚ªãƒ¼ãƒ è¨­å®šå¯¾å¿œ
- åœ°å½¢ç‰¹æ€§ã®å±€æ‰€çš„å¤‰æ›´æ©Ÿèƒ½
- ãƒ—ãƒªã‚»ãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆ
- ç’°å¢ƒæ¡ä»¶ã«å¿œã˜ãŸç‰¹å¾´ç”Ÿæˆ

ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€ã€Œåœ°å½¢ãŒè‡ªç„¶ãªå·ã€å±±è„ˆã€è°·ã‚’å«ã‚€ã€ã¨ã„ã†è¦æ±‚ãŒå®Œå…¨ã«æº€ãŸã•ã‚Œã¦ã„ã¾ã™ã€‚